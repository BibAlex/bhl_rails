= BA BHL site

== GETTING STARTED
Things you need:

  Ruby:    ruby 1.9.3p392 (2013-02-22) [i386-mingw32]
  Rubygem: 2.0.7
  Rails:   3.2.9
  Perl:	   perl 5, version 16

=== Prepare the environment

  1.  install mysql server 5.5
      sudo apt-get install mysql-server-5.5

  2.  install ruby 1.9
      sudo apt-get install ruby1.9.1 ruby1.9.1-dev

  3.  Install jre
      sudo apt-get install default-jre

  4.  install git
      sudo apt-get install git

  5.  download and run solr
      mkdir solr
      git clone https://github.com/BibAlex/bhl_rails_solr.git solr
      cd solr/example
      java -jar start.jar
      make sure localhost:8988/solr is up and running

  6.  download and run solr_test
      mkdir solr_test
      git clone https://github.com/BibAlex/bhl_solr_test.git solr_test
      cd solr_test/example
      java -jar start;jar
      make sure localhost:8989solr is up and running

  7.  install rubygems
      cd /opt/
      sudo mkdir rubygems
      cd rubygems
      sudo wget http://production.cf.rubygems.org/rubygems/rubygems-2.1.7.zip
      sudo unzip rubygems-2.1.7.zip 
      cd rubygems-2.1.7/
      sudo ruby setup.rb #gem -v should now be 2.1.7
      sudo gem update --system 2.0.7 #gem -v should now be 2.0.7

  8.  install rails
      sudo gem install rails -v 3.2.13

  9.  Prepare the environment
      sudo apt-get install libxslt-dev libxml2-dev
      apt-get install libmysql-ruby libmysqlclient-dev nodejs perl

  10. Download the code
      mkdir bhl_rails
      git clone https://github.com/BibAlex/bhl_rails.git bhl_rails


=== INSTALLATION

  1.  bundle install
  2.  copy config/database.sample.yml to config/database.yml and fix the database settings
  3.  copy config/environment.sample.rb to config/environment.rb and fix some constants
  4.  rake db:create:all # to create all databases if not exist 
  5.  rake db:migrate; rake db:migrate RAILS_ENV=test
  6.  rake spec # to make sure all tests are green
  7.  rake scenarios:load NAME=bootstrap # this scenario will fill the DB with 100 books with only BIBIDs
  8.  rake dar:update_all_metadata # this will download all metadata for books from DAR
  9.  rake bhl:update_empty_locations # to update locations/countries
  	  Then you should remove duplicate locations (rake bhl:remove_duplicate_locations)
  10. rake dar:download_volume_content (make sure folder public/volumes exists)
  11. rake dar:download_thumbs
  12. perl taxon_finder/server.pl
  	  rake taxon_finder:find_names
  13. start solr: cd solr/examples; java -jar start.jar; check it: http://localhost:8988/solr
  14. rake solr_indexer:index_all_books
  15. rake eol_names:download_all_details
      rake eol_names:download_all_thumbs (make sure public/thumbs exists)
  16. rake bhl:update_empty_bibtext_endnote
  
  
== Common issues
 - Make sure folder tmp/cache exists 

