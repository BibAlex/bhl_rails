%link{:type => "text/css", :rel => "stylesheet", :href => "http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css"}
%script{:type => "text/javascript", :src  => "http://code.jquery.com/jquery-1.9.1.js"}
%script{:type => "text/javascript", :src  => "http://code.jquery.com/ui/1.10.3/jquery-ui.js"}

:javascript
  $(document).ready(function() {
    $( "#dialog" ).dialog({
      position: ['top', 100], 
      autoOpen: false, 
      modal: true, 
      title: "#{I18n.t(:add_book_dialog_title)}",
      buttons: { 
        "#{I18n.t(:save)}": function() {
                              var col_id = $("#idselect").val(), 
                              title = $("#title").val(),
                              description = $("#description").val(),
                              public = $("#public").val(),
                              new_col = $("#new").val();
                             
                              if(new_col == 'off'){
                                $.ajax({type: "GET", 
                                       url: "/add_book?col_id=" + col_id +"&id=" + "#{params[:id]}", 
                                       dataType: "script"
                                       });
                                $(this).dialog("close");
                              }else{
                                if(title == ''){
                                  $("#error").show();
                                }else{
                                   $.ajax({type: "GET", 
                                       url: "/add_book?title=" + escape(title) + "&description=" + escape(description) + "&public=" + escape(public), 
                                       dataType: "script"
                                       }) ;
                                   $(this).dialog("close");
                                   $("#error").hide();
                                }
                              }
                             }, 
        "#{I18n.t(:cancel)}": function() {$(this).dialog("close");$("#error").hide();}
      } 
    });
    $( "#opener#{@number}" ).click(function() {
      $( "#dialog" ).dialog( "open" );
    });
  });   
-# TODO style fixing 
#dialog{ :style => "display: none;" }
  .form
    %ul
      - if Collection.count > 0
        %li
          = I18n.t(:choose_collection)
        %li
        - collections = Collection.where(:user_id => session[:user_id])
        %select#idselect
          - collections.each do |collection|
            %option{:value => "#{collection.id}"} #{collection.title}
        %br
        %br
      %li
        %input#new{:checked => "false", :type =>"checkbox", :value => 'off', 
        :onclick => "document.getElementById('error').style.display = 'none';document.getElementById('description').value = '';document.getElementById('title').value = '';if(this.checked == true){this.value = 'on';document.getElementById('createnewcoll').style.display = 'block';}else{this.value = 'off';document.getElementById('createnewcoll').style.display = 'none';}"} #{I18n.t(:create_new_collection)}
      #error{style: "display:none; color:red;"}
        = I18n.t(:missing_title_error_msg)
      #createnewcoll{style: "display:none;"}
        = "#{I18n.t(:title)}*"
        %br
        %input#title{type: "text"} 
        = I18n.t(:description)
        %textarea#description
        %br
        %input#public{:checked => "false", :type =>"checkbox", :value => 'off',
        :onclick => "if(this.checked == true){this.value = 'on';}else{this.value = 'off';}"} #{I18n.t(:public)}
     
-# TODO style fixing 
#button
- if @place == "details" || @place == "read"
  %input{type: "button", class:"addbookdetails", id: "opener#{@number}", value: "#{I18n.t(:add_to_collection)}", :onclick => "document.getElementById('new').checked=false;document.getElementById('public').checked=false;document.getElementById('createnewcoll').style.display = 'none';"}
- elsif @place == "list"
  %input{type: "image", alt: "#{I18n.t(:add_to_collection)}", title: "#{I18n.t(:add_to_collection)}", src: "/images_#{I18n.locale}/add.png", class: "addbooklist", id: "opener#{@number}", value: "#{I18n.t(:add_to_collection)}", :onclick => "document.getElementById('new').checked=false;document.getElementById('public').checked=false;document.getElementById('createnewcoll').style.display = 'none';"}
