%link{:type => "text/css", :rel => "stylesheet", :href => "http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css"}
%script{:type => "text/javascript", :src  => "http://code.jquery.com/jquery-1.9.1.js"}
%script{:type => "text/javascript", :src  => "http://code.jquery.com/ui/1.10.3/jquery-ui.js"}

:javascript
  $(document).ready(function() {
    
    $( "#dialog_#{@number}" ).dialog({
      position: ['top', 100], 
      autoOpen: false, 
      modal: true, 
      title: "#{I18n.t(:add_book_dialog_title)}",
      buttons: { 
        "#{I18n.t(:save)}": function() {
                              var col_id = $("#idselect").val(), 
                              title = $("#title").val(),
                              description = $("#description").val(),
                              public = $("#public").val(),
                              new_col = $("#new").val();
                             
                              if(new_col == 'off'){
                                $.ajax({type: "GET", 
                                       url: "/add_book?col_id=" + col_id +"&vol_id=" + "#{params[:id]}", 
                                       dataType: "script"
                                       });
                                $(this).dialog("close");
                              }else{
                                if(title.trim().length == 0){
                                  $("#error").show();
                                }else{
                                   $.ajax({type: "GET", 
                                       url: "/add_book?title=" + escape(title) + "&description=" + escape(description) + "&public=" + escape(public) + "&vol_id=" + "#{params[:id]}", 
                                       dataType: "script"
                                       }) ;
                                   $(this).dialog("close");
                                   $("#error").hide();
                                }
                              }
                             }, 
        "#{I18n.t(:cancel)}": function() {$(this).dialog("close");$("#error").hide();}
      } 
    });
    $( "#opener#{@number}" ).click(function() {
      if(document.getElementById("new") != null){
        document.getElementById("new").checked = false;
      }
      if(document.getElementById("public") != null){
        document.getElementById("public").checked = false;
      }
      var xmlhttp;
      if (window.XMLHttpRequest){ 
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp=new XMLHttpRequest();
      }
      else{
        // code for IE6, IE5
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
      }
      xmlhttp.onreadystatechange=function(){
        if (xmlhttp.readyState==4 && xmlhttp.status==200){
          document.getElementById("dialog_#{@number}").innerHTML=xmlhttp.responseText;
        }
      }
      xmlhttp.open("GET","/dialog_content",true);
      xmlhttp.send();
      
      $( "#dialog_#{@number}" ).dialog( "open" );
       
    });
  });   
= params[:vol_id]
-# TODO style fixing 
#dialog{ :style => "display: none;",  id: "#{@number}" }
-# TODO style fixing 
#button
  - if @place == "details" || @place == "read"
    %input{type: "button", class:"addbookdetails", id: "opener#{@number}", value: "#{I18n.t(:add_to_collection)}"}
  - elsif @place == "list"
    %input{type: "image", alt: "#{I18n.t(:add_to_collection)}", title: "#{I18n.t(:add_to_collection)}", src: "/images_#{I18n.locale}/add.png", class: "addbooklist", id: "opener#{@number}", value: "#{I18n.t(:add_to_collection)}"}
